import{_ as s,e as a,f as e,o as i}from"./app-fvSY76QE.js";const l={};function d(p,n){return i(),a("div",null,n[0]||(n[0]=[e(`<h2 id="模式" tabindex="-1"><a class="header-anchor" href="#模式"><span>模式</span></a></h2><ul><li><p>mod=0 ，即：(balance-rr) Round-robin policy（平衡抡循环策略） 特点：传输数据包顺序是依次传输（即：第1个包走eth0，下一个包就走eth1….一直循环下去，直到最后一个传输完毕），此模式提供负载平衡和容错能力；但是我们知道如果一个连接或者会话的数据包从不同的接口发出的话，中途再经过不同的链路，在客户端很有可能会出现数据包无序到达的问题，而无序到达的数据包需要重新要求被发送，这样网络的吞吐量就会下降</p></li><li><p>mod=1，即： (active-backup) Active-backup policy（主-备份策略） 特点：只有一个设备处于活动状态，当一个宕掉另一个马上由备份转换为主设备。mac地址是外部可见得，从外面看来，bond的MAC地址是唯一的，以避免switch(交换机)发生混乱。此模式只提供了容错能力；由此可见此算法的优点是可以提供高网络连接的可用性，但是它的资源利用率较低，只有一个接口处于工作状态，在有 N 个网络接口的情况下，资源利用率为1/N</p></li><li><p>mod=2，即：(balance-xor) XOR policy（平衡策略） 特点：基于指定的传输HASH策略传输数据包。缺省的策略是：(源MAC地址 XOR 目标MAC地址) % slave数量。其他的传输策略可以通过xmit_hash_policy选项指定，此模式提供负载平衡和容错能力</p></li><li><p>mod=3，即：broadcast（广播策略） 特点：在每个slave接口上传输每个数据包，此模式提供了容错能力</p></li><li><p>mod=4，即：(802.3ad) IEEE 802.3adDynamic link aggregation（IEEE 802.3ad 动态链接聚合） 特点：创建一个聚合组，它们共享同样的速率和双工设定。根据802.3ad规范将多个slave工作在同一个激活的聚合体下。 外出流量的slave选举是基于传输hash策略，该策略可以通过xmit_hash_policy选项从缺省的XOR策略改变到其他策略。需要注意的是，并不是所有的传输策略都是802.3ad适应的，尤其考虑到在802.3ad标准43.2.4章节提及的包乱序问题。不同的实现可能会有不同的适应性。 必要条件： 条件1：ethtool支持获取每个slave的速率和双工设定 条件2：switch(交换机)支持IEEE 802.3ad Dynamic link aggregation 条件3：大多数switch(交换机)需要经过特定配置才能支持802.3ad模式</p></li><li><p>mod=5，即：(balance-tlb) Adaptive transmit load balancing（适配器传输负载均衡） 特点：不需要任何特别的switch(交换机)支持的通道bonding。在每个slave上根据当前的负载（根据速度计算）分配外出流量。如果正在接受数据的slave出故障了，另一个slave接管失败的slave的MAC地址。 该模式的必要条件：ethtool支持获取每个slave的速率</p></li><li><p>mod=6，即：(balance-alb) Adaptive load balancing（适配器适应性负载均衡） 特点：该模式包含了balance-tlb模式，同时加上针对IPV4流量的接收负载均衡(receive load balance, rlb)，而且不需要任何switch(交换机)的支持。接收负载均衡是通过ARP协商实现的。bonding驱动截获本机发送的ARP应答，并把源硬件地址改写为bond中某个slave的唯一硬件地址，从而使得不同的对端使用不同的硬件地址进行通信。</p></li></ul><h2 id="rhel7链路聚合-用bond-命令如下" tabindex="-1"><a class="header-anchor" href="#rhel7链路聚合-用bond-命令如下"><span>rhel7链路聚合，用bond，命令如下</span></a></h2><h3 id="查看是否支持bond" tabindex="-1"><a class="header-anchor" href="#查看是否支持bond"><span>查看是否支持bond</span></a></h3><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>modinfo bonding</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="创建一个虚拟网卡" tabindex="-1"><a class="header-anchor" href="#创建一个虚拟网卡"><span>创建一个虚拟网卡</span></a></h3><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>nmcli connection add con-name yinhang ifname bond1 type bond mode active-backup miimon 100</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="把两个网卡加入到虚拟网卡下做小弟" tabindex="-1"><a class="header-anchor" href="#把两个网卡加入到虚拟网卡下做小弟"><span>把两个网卡加入到虚拟网卡下做小弟</span></a></h3><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>nmcli connection add con-name yinhang-port1 ifname ens33 type bond-slave master bond1</span></span>
<span class="line"><span>nmcli connection add con-name yinhang-port2 ifname ens37 type bond-slave master bond2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="设置固定ip等" tabindex="-1"><a class="header-anchor" href="#设置固定ip等"><span>设置固定IP等</span></a></h3><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>vim /etc/sysconfig/network-scripts/ifcfg-yinhang</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>DEVICE=bond1</span></span>
<span class="line"><span>BONDING_OPTS=&quot;miimon=100 mode=active-backup&quot;</span></span>
<span class="line"><span>TYPE=Bond</span></span>
<span class="line"><span>BONDING_MASTER=yes</span></span>
<span class="line"><span>BOOTPROTO=static</span></span>
<span class="line"><span>DEFROUTE=yes</span></span>
<span class="line"><span>PEERDNS=yes</span></span>
<span class="line"><span>PEERROUTES=yes</span></span>
<span class="line"><span>IPV4_FAILURE_FATAL=no</span></span>
<span class="line"><span>NAME=test</span></span>
<span class="line"><span>ONBOOT=yes</span></span>
<span class="line"><span>IPADDR=192.168.1.1</span></span>
<span class="line"><span>NETMASK=255.255.255.0</span></span>
<span class="line"><span>GATEWAY=192.168.1.254</span></span>
<span class="line"><span>DNS1=114.114.114.114</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查看bond状态" tabindex="-1"><a class="header-anchor" href="#查看bond状态"><span>查看bond状态</span></a></h3><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>cat /proc/net/bonding/bond1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="重启服务" tabindex="-1"><a class="header-anchor" href="#重启服务"><span>重启服务</span></a></h3><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>nmcli con reload</span></span>
<span class="line"><span>systemctl restart network.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="已经实操的rhel7过程如下" tabindex="-1"><a class="header-anchor" href="#已经实操的rhel7过程如下"><span>已经实操的rhel7过程如下：</span></a></h3><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>Systemctl stop NetworkManager服务</span></span>
<span class="line"><span>Systemctl disable NetworkManager服务</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="加载bonding模块" tabindex="-1"><a class="header-anchor" href="#加载bonding模块"><span>加载bonding模块</span></a></h3><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>modprobe --first-time bonding</span></span>
<span class="line"><span>Vim Ifcfg-bond0</span></span>
<span class="line"><span>DEVICE=bond0</span></span>
<span class="line"><span>TYPE=Bond</span></span>
<span class="line"><span>ONBOOT=yes</span></span>
<span class="line"><span>BOOTPROTO=none</span></span>
<span class="line"><span>USERCTL=no</span></span>
<span class="line"><span>PEERDNS=yes</span></span>
<span class="line"><span>IPADDR=72.26.65.</span></span>
<span class="line"><span>NETMASK=255.255.255.0</span></span>
<span class="line"><span>GATEWAY=72.26.65.254</span></span>
<span class="line"><span>BONDING_OPTS=&quot;miimon=100 mode=0&quot;</span></span>
<span class="line"><span>BONDING_MASTER=yes</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>Vim Ifcfg-eno1</span></span>
<span class="line"><span>TYPE=Ethernet</span></span>
<span class="line"><span>BOOTPROTO=none</span></span>
<span class="line"><span>NAME=eno1</span></span>
<span class="line"><span>DEVICE=eno1</span></span>
<span class="line"><span>ONBOOT=yes</span></span>
<span class="line"><span>MASTER=bond0</span></span>
<span class="line"><span>SLAVE=yes</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>Vim Ifcfg-eno2</span></span>
<span class="line"><span>TYPE=Ethernet</span></span>
<span class="line"><span>BOOTPROTO=none</span></span>
<span class="line"><span>NAME=eno2</span></span>
<span class="line"><span>DEVICE=eno2</span></span>
<span class="line"><span>ONBOOT=yes</span></span>
<span class="line"><span>MASTER=bond0</span></span>
<span class="line"><span>SLAVE=yes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>Systemctl restart network</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>cat /proc/net/bonding/bond0</code> 查看当前哪个网口是主用网口</p><h3 id="已经实操的rhel6过程如下" tabindex="-1"><a class="header-anchor" href="#已经实操的rhel6过程如下"><span>已经实操的rhel6过程如下：</span></a></h3><p>1.关闭和停止NetworkManager服务</p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>service  NetworkManager stop</span></span>
<span class="line"><span>chkconfig NetworkManager off</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>2.加载bonding模块</p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>modprobe --first-time bonding</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>3.查看有哪些网口<code>ifconfig -a</code></p><p>4.<code>cd /etc/sysconfig/network-scripts/</code></p><p><code>vim ifcfg-ens33</code></p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>TYPE=Ethernet</span></span>
<span class="line"><span>BOOTPROTO=none</span></span>
<span class="line"><span>NAME=ens33</span></span>
<span class="line"><span>DEVICE=ens33</span></span>
<span class="line"><span>ONBOOT=yes</span></span>
<span class="line"><span>HWADDR=00:0c:29:40:35:7d</span></span>
<span class="line"><span>NM_CONTROLLED=no</span></span>
<span class="line"><span>MASTER=bond0</span></span>
<span class="line"><span>SLAVE=yes</span></span>
<span class="line"><span>vim ifcfg-ens37</span></span>
<span class="line"><span>TYPE=Ethernet</span></span>
<span class="line"><span>BOOTPROTO=none #使用什么协议激活网口</span></span>
<span class="line"><span>                                              none表示不使用任何协议</span></span>
<span class="line"><span>                                              static表示设置静态IP</span></span>
<span class="line"><span>                                              dhcp表示动态获取IP</span></span>
<span class="line"><span>NAME=ens37</span></span>
<span class="line"><span>DEVICE=ens37</span></span>
<span class="line"><span>ONBOOT=yes</span></span>
<span class="line"><span>HWADDR=00:0c:29:40:35:87</span></span>
<span class="line"><span>NM_CONTROLLED=no</span></span>
<span class="line"><span>MASTER=bond0 #指定虚拟网口的名字</span></span>
<span class="line"><span>  SLAVE=yes     #备用</span></span>
<span class="line"><span>备注：eth0、eth1的MASTER（主人）是bond0，本身是属于从设备作为bond0的SLAVE（备用）</span></span>
<span class="line"><span>vim ifcfg-bond0</span></span>
<span class="line"><span>TYPE=Bond</span></span>
<span class="line"><span>BOOTPROTO=none</span></span>
<span class="line"><span>NAME=bond0</span></span>
<span class="line"><span>DEVICE=bond0</span></span>
<span class="line"><span>ONBOOT=yes</span></span>
<span class="line"><span>NM_CONTROLLED=no</span></span>
<span class="line"><span>USERCTL=no</span></span>
<span class="line"><span>IPADDR=10.1.1.100</span></span>
<span class="line"><span>NETMASK=255.255.255.0</span></span>
<span class="line"><span>GATEWAY=10.1.1.1</span></span>
<span class="line"><span>BONDING_OPTS=&#39;mode=6 miimon=100&#39;  （或者这条可以单独写）</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>vim /etc/modprobe.d/bonding.conf</code> 添加</p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>alias bond0 bonding</span></span>
<span class="line"><span>options bond0 mode=1 miimon=100</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>//miimon是用来进行链路监测的：miimon=100表示系统每100ms监测一次链路连接状态，如 果有一条线路不同就转入另一条线路。 //mode=1表示属于主备模式。</p><p>6.加载bond0接口到内核 <code>vi /etc/modprobe.d/bonding.conf</code> 修改成如下:<code>alias bond0 bonding</code></p><p>7.加载模块、重启网络与测试</p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>modprobe bonding</span></span>
<span class="line"><span>service network restart</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>8.如果查看当前哪个网口是主用网口 cat /proc/net/bonding/bond0</p>`,38)]))}const c=s(l,[["render",d],["__file","index.html.vue"]]),r=JSON.parse('{"path":"/os/linux/6zjj46bu/","title":"网卡聚合","lang":"zh-CN","frontmatter":{"title":"网卡聚合","createTime":"2025/04/17 09:10:20","permalink":"/os/linux/6zjj46bu/","description":"模式 mod=0 ，即：(balance-rr) Round-robin policy（平衡抡循环策略） 特点：传输数据包顺序是依次传输（即：第1个包走eth0，下一个包就走eth1….一直循环下去，直到最后一个传输完毕），此模式提供负载平衡和容错能力；但是我们知道如果一个连接或者会话的数据包从不同的接口发出的话，中途再经过不同的链路，在客户端很有可能...","head":[["meta",{"property":"og:url","content":"http://git.x-echo.net/os/linux/6zjj46bu/"}],["meta",{"property":"og:site_name","content":"谈呀"}],["meta",{"property":"og:title","content":"网卡聚合"}],["meta",{"property":"og:description","content":"模式 mod=0 ，即：(balance-rr) Round-robin policy（平衡抡循环策略） 特点：传输数据包顺序是依次传输（即：第1个包走eth0，下一个包就走eth1….一直循环下去，直到最后一个传输完毕），此模式提供负载平衡和容错能力；但是我们知道如果一个连接或者会话的数据包从不同的接口发出的话，中途再经过不同的链路，在客户端很有可能..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-03-17T06:31:31.000Z"}],["meta",{"property":"article:modified_time","content":"2025-03-17T06:31:31.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"网卡聚合\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-03-17T06:31:31.000Z\\",\\"author\\":[]}"]]},"headers":[],"readingTime":{"minutes":5.01,"words":1502},"git":{"updatedTime":1742193091000,"contributors":[{"name":"wyutan","username":"wyutan","email":"90786339+wyutan@users.noreply.github.com","commits":1,"avatar":"https://avatars.githubusercontent.com/wyutan?v=4","url":"https://github.com/wyutan"}],"changelog":[{"hash":"da9be509e1058c600f5dbc08b58079891600281b","date":1742193091000,"email":"90786339+wyutan@users.noreply.github.com","author":"wyutan","message":"Create 3.网卡聚合.md","commitUrl":"https://github.com/wyutan/tanya//commit/da9be509e1058c600f5dbc08b58079891600281b"}]},"autoDesc":true,"filePathRelative":"os/linux/note/3.网卡聚合.md"}');export{c as comp,r as data};
