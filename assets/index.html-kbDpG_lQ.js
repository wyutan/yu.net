import{_ as e,e as s,f as n,o as i}from"./app-fvSY76QE.js";const t={};function l(c,a){return i(),s("div",null,a[0]||(a[0]=[n(`<h2 id="keepalived-配置文件" tabindex="-1"><a class="header-anchor" href="#keepalived-配置文件"><span>keepalived 配置文件</span></a></h2><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>! /etc/keepalived/keepalived.conf</span></span>
<span class="line"><span>! Configuration File for keepalived</span></span>
<span class="line"><span>global_defs {</span></span>
<span class="line"><span>    router_id LVS_DEVEL</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>vrrp_script check_apiserver {</span></span>
<span class="line"><span>  script &quot;/etc/keepalived/check_apiserver.sh&quot;</span></span>
<span class="line"><span>  interval 3</span></span>
<span class="line"><span>  weight -2</span></span>
<span class="line"><span>  fall 10</span></span>
<span class="line"><span>  rise 2</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>vrrp_instance VI_1 {</span></span>
<span class="line"><span>    state \${STATE}</span></span>
<span class="line"><span>    interface \${INTERFACE}</span></span>
<span class="line"><span>    virtual_router_id \${ROUTER_ID}</span></span>
<span class="line"><span>    priority \${PRIORITY}</span></span>
<span class="line"><span>    authentication {</span></span>
<span class="line"><span>        auth_type PASS</span></span>
<span class="line"><span>        auth_pass \${AUTH_PASS}</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    virtual_ipaddress {</span></span>
<span class="line"><span>        \${APISERVER_VIP}</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    track_script {</span></span>
<span class="line"><span>        check_apiserver</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>有一些bash变量样式的占位符需要填写：</p><ul><li><code>\${STATE}</code>一个<code>MASTER</code>和其他所有主机<code>BACKUP</code>，因此虚拟 IP 最初将分配给<code>MASTER</code>；</li><li><code>\${INTERFACE}</code>是参与虚拟 IP 协商的网络接口，例如<code>eth0</code>；</li><li><code>\${ROUTER_ID}</code>在同一子网中的所有集群之间应是唯一的，同时在同一个<code>Keepalived</code>集群的所有主机之间应保持一致。许多发行版将其值预先配置为<code>51</code>；</li><li><code>\${PRIORITY}</code>控制平面节点上的值应高于备份节点上的值，因此<code>101</code>和<code>100</code>分别就足够了；</li><li><code>\${AUTH_PASS}\`\`keepalived</code>对于所有集群主机都应该相同，例如<code>42</code>；</li><li><code>\${APISERVER_VIP}</code>是集群主机之间协商的虚拟 IP 地址<code>keepalived</code>。</li></ul><h2 id="健康检查脚本" tabindex="-1"><a class="header-anchor" href="#健康检查脚本"><span>健康检查脚本</span></a></h2><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>#!/bin/sh</span></span>
<span class="line"><span></span></span>
<span class="line"><span>errorExit() {</span></span>
<span class="line"><span>    echo &quot;*** $*&quot; 1&gt;&amp;2</span></span>
<span class="line"><span>    exit 1</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>curl -sfk --max-time 2 https://localhost:\${APISERVER_DEST_PORT}/healthz -o /dev/null || errorExit &quot;Error GET https://localhost:\${APISERVER_DEST_PORT}/healthz&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>\${APISERVER_DEST_PORT}</code>使用 Kubernetes 与 API 服务器通信的端口填写占位符，这是 haproxy 或您的负载均衡器将监听的端口。</li></ul>`,7)]))}const d=e(t,[["render",l],["__file","index.html.vue"]]),o=JSON.parse('{"path":"/%E5%AE%B9%E5%99%A8/5ogsyhhs/","title":"k8s高可用配置","lang":"zh-CN","frontmatter":{"title":"k8s高可用配置","createTime":"2025/04/17 09:10:20","permalink":"/容器/5ogsyhhs/","description":"keepalived 配置文件 有一些bash变量样式的占位符需要填写： ${STATE}一个MASTER和其他所有主机BACKUP，因此虚拟 IP 最初将分配给MASTER； ${INTERFACE}是参与虚拟 IP 协商的网络接口，例如eth0； ${ROUTER_ID}在同一子网中的所有集群之间应是唯一的，同时在同一个Keepalived集群的所...","head":[["meta",{"property":"og:url","content":"http://git.x-echo.net/%E5%AE%B9%E5%99%A8/5ogsyhhs/"}],["meta",{"property":"og:site_name","content":"谈呀"}],["meta",{"property":"og:title","content":"k8s高可用配置"}],["meta",{"property":"og:description","content":"keepalived 配置文件 有一些bash变量样式的占位符需要填写： ${STATE}一个MASTER和其他所有主机BACKUP，因此虚拟 IP 最初将分配给MASTER； ${INTERFACE}是参与虚拟 IP 协商的网络接口，例如eth0； ${ROUTER_ID}在同一子网中的所有集群之间应是唯一的，同时在同一个Keepalived集群的所..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-03-17T05:59:33.000Z"}],["meta",{"property":"article:modified_time","content":"2025-03-17T05:59:33.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"k8s高可用配置\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-03-17T05:59:33.000Z\\",\\"author\\":[]}"]]},"headers":[],"readingTime":{"minutes":1.02,"words":305},"git":{"updatedTime":1742191173000,"contributors":[{"name":"wyutan","username":"wyutan","email":"90786339+wyutan@users.noreply.github.com","commits":7,"avatar":"https://avatars.githubusercontent.com/wyutan?v=4","url":"https://github.com/wyutan"}],"changelog":[{"hash":"bfda67715fbfd9ae4c4078c7b3ef5dae5e8b354e","date":1741846472000,"email":"90786339+wyutan@users.noreply.github.com","author":"wyutan","message":"Update and rename 2.配置keepalive.md to 1.高可用配置.md","commitUrl":"https://github.com/wyutan/tanya//commit/bfda67715fbfd9ae4c4078c7b3ef5dae5e8b354e"},{"hash":"48de24420dcbfac4743c49eb4abb0b93c680cf63","date":1741846511000,"email":"90786339+wyutan@users.noreply.github.com","author":"wyutan","message":"Rename 1.高可用配置.md to 1.k8s高可用配置.md","commitUrl":"https://github.com/wyutan/tanya//commit/48de24420dcbfac4743c49eb4abb0b93c680cf63"},{"hash":"e7cb936da37ef1033b24ac3c67bb1e9c50f551bd","date":1741847033000,"email":"90786339+wyutan@users.noreply.github.com","author":"wyutan","message":"Update 1.k8s高可用配置.md","commitUrl":"https://github.com/wyutan/tanya//commit/e7cb936da37ef1033b24ac3c67bb1e9c50f551bd"},{"hash":"70a49bf62dce24c2aae38a855b7739b41a5fbc4f","date":1741957721000,"email":"90786339+wyutan@users.noreply.github.com","author":"wyutan","message":"更新 1.k8s高可用配置.md","commitUrl":"https://github.com/wyutan/tanya//commit/70a49bf62dce24c2aae38a855b7739b41a5fbc4f"},{"hash":"049243529999f1555ac94b6979ba37bce10f6efb","date":1741957898000,"email":"90786339+wyutan@users.noreply.github.com","author":"wyutan","message":"更新 1.k8s高可用配置.md","commitUrl":"https://github.com/wyutan/tanya//commit/049243529999f1555ac94b6979ba37bce10f6efb"},{"hash":"b1f825d8b527df32dc888365429817d3cc1f0582","date":1742185216000,"email":"90786339+wyutan@users.noreply.github.com","author":"wyutan","message":"Update 1.k8s高可用配置.md","commitUrl":"https://github.com/wyutan/tanya//commit/b1f825d8b527df32dc888365429817d3cc1f0582"},{"hash":"e70f5b5c6f525510ac53d7e71daabf4694720e21","date":1742191173000,"email":"90786339+wyutan@users.noreply.github.com","author":"wyutan","message":"Update 1.k8s高可用配置.md","commitUrl":"https://github.com/wyutan/tanya//commit/e70f5b5c6f525510ac53d7e71daabf4694720e21"}]},"autoDesc":true,"filePathRelative":"容器/k8s/note/1.k8s高可用配置.md","categoryList":[{"id":"22c799","sort":10000,"name":"容器"},{"id":"eb26bc","sort":10003,"name":"k8s"},{"id":"74a94d","sort":10004,"name":"note"}]}');export{d as comp,o as data};
